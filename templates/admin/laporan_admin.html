{% extends 'base.html' %} {% block title %}Laporan Pesanan{% endblock %} {%block
content %}
<div class="container mt-5">
  <h3 class="mb-4">Manajemen Pesanan</h3>

  <div class="table-container shadow-sm p-3 bg-white rounded">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Pelanggan</th>
          <th>Paket</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for l in laporan %}
        <tr>
          <td>{{ l.id }}</td>
          <td>{{ l.tgl_wisata.strftime('%d %b %Y') }}</td>
          <td>{{ l.username }}</td>
          <td>{{ l.nama_paket }} ({{ l.jumlah_orang }} orang)</td>
          <td>
            <span
              class="badge {% if l.status == 'Pending' %}bg-warning text-dark{% elif l.status == 'Dibatalkan' %}bg-danger{% else %}bg-success{% endif %}"
            >
              {{ l.status }}
            </span>
          </td>
          <td>
            <button
              class="btn btn-sm btn-info text-white"
              data-bs-toggle="modal"
              data-bs-target="#modalCatatan{{ l.id }}"
            >
              <i class="bi bi-eye"></i> Detail
            </button>

            {% if l.status != 'Dibatalkan' %}
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-sm btn-dark dropdown-toggle"
                data-bs-toggle="dropdown"
                data-bs-boundary="viewport"
              >
                Kelola
              </button>
              <ul class="dropdown-menu shadow">
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('update_status', id=l.id, status='Dikonfirmasi') }}"
                    >Konfirmasi</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ url_for('update_status', id=l.id, status='Selesai') }}"
                    >Selesaikan</a
                  >
                </li>
              </ul>
            </div>
            {% else %}
            <span class="text-muted small ms-2"
              ><i class="bi bi-x-circle"></i> No Action</span
            >
            {% endif %}
          </td>
        </tr>

        <div class="modal fade" id="modalCatatan{{ l.id }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Detail Pesanan {{ l.id }}</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <p><strong>Nama Paket:</strong> {{ l.nama_paket }}</p>
                <p><strong>Jumlah:</strong> {{ l.jumlah_orang }} Orang</p>
                <hr />
                <h6>Catatan Pelanggan:</h6>
                <div class="p-3 bg-light rounded italic">
                  "{{ l.catatan if l.catatan else 'Tidak ada catatan.' }}"
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
